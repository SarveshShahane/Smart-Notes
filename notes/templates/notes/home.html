<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Notes</title>
    <style>
    body {
      background: #f4f6f8;
      color: #222;
      transition: background 0.3s, color 0.3s;
    }
    .notes-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px;
    }
    .note-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s, color 0.3s;
    }
    .note-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }
    .note-card h2 {
      font-size: 1.3rem;
      margin-bottom: 8px;
      color: #333;
      transition: color 0.3s;
    }
    .note-content {
      margin-bottom: 10px;
      line-height: 1.4;
      color: #555;
      transition: color 0.3s;
      word-break: break-word;
    }
    .note-tags {
      font-size: 0.9rem;
      color: #007bff;
      font-style: italic;
      margin-bottom: 12px;
      transition: color 0.3s;
    }
    .note-delete, .note-export {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9rem;
      transition: background-color 0.2s ease;
      margin-right: 8px;
      cursor: pointer;
    }
    .note-delete {
      background-color: #dc3545;
      color: #fff;
    }
    .note-delete:hover {
      background-color: #a71d2a;
    }
    .note-export {
      background-color: #1976d2;
      color: #fff;
      border: none;
    }
    .note-export:hover {
      background-color: #004ba0;
    }
    body.dark-mode {
      background: #181a1b;
      color: #e2e2e2;
    }
    body.dark-mode .note-card {
      background: #23272b;
      border-color: #444;
      color: #e2e2e2;
    }
    body.dark-mode .note-card h2 {
      color: #e2e2e2;
    }
    body.dark-mode .note-content {
      color: #bdbdbd;
    }
    body.dark-mode .note-tags {
      color: #90caf9;
    }
    body.dark-mode .note-delete {
      background-color: #b71c1c;
      color: #fff;
    }
    body.dark-mode .note-delete:hover {
      background-color: #7f0000;
    }
    body.dark-mode .note-export {
      background-color: #1565c0;
      color: #fff;
    }
    body.dark-mode .note-export:hover {
      background-color: #002171;
    }
    </style>
</head>
<body>
    <div>{% include 'notes/navbar.html' %}</div>
    {% if messages %}
    <div class="messages" id="flash-messages">
      {% for message in messages %}
        <div class="alert {{ message.tags }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <div class="notes-container">
      {% for note in notes %}
          <div class="note-card" data-title="{{ note.title }}">
              <h2>{{ note.title }}</h2>
              <div class="note-content">{{ note.content }}</div>
              <p class="note-tags">Tags: {{ note.tags }}</p>
              <a class="note-delete" href="{% url 'delete_note' note.id %}">Delete</a>
              <button class="note-export" onclick="exportNote('{{ note.title|escapejs }}', `{{ note.content|escapejs }}`, `{{ note.tags|escapejs }}`)">Export</button>
          </div>
      {% endfor %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      
      setTimeout(function() {
        const flashMessages = document.getElementById("flash-messages");
        if (flashMessages) {
          flashMessages.style.transition = "opacity 0.5s ease";
          flashMessages.style.opacity = "0";
          setTimeout(() => flashMessages.remove(), 500); // fully remove after fade
        }
      }, 3000);

      
      function setDarkMode(enabled) {
        document.body.classList.toggle('dark-mode', enabled);
        localStorage.setItem('darkMode', enabled ? '1' : '0');
      }
        
      function syncDarkModeFromStorage() {
        const enabled = localStorage.getItem('darkMode') === '1';
        setDarkMode(enabled);
        const toggleBtn = document.getElementById('dark-mode-toggle');
        if (toggleBtn) {
          toggleBtn.textContent = enabled ? 'Light Mode' : 'Dark Mode';
        }
      }
        
      document.addEventListener('DOMContentLoaded', function() {
        syncDarkModeFromStorage();
        const toggleBtn = document.getElementById('dark-mode-toggle');
        if (toggleBtn) {
          toggleBtn.onclick = function() {
            const enabled = !(document.body.classList.contains('dark-mode'));
            setDarkMode(enabled);
            toggleBtn.textContent = enabled ? 'Light Mode' : 'Dark Mode';
          };
        }


        document.querySelectorAll('.note-card').forEach(function(card){
          const title = card.dataset.title;
          const color = localStorage.getItem('note-color-' + title);
          if(color) card.style.background = color;
          const nc = card.querySelector('.note-content');
          if (nc) nc.innerHTML = marked.parse(nc.textContent);
        });
      });

      function exportNote(title, content, tags) {
        const text = `Title: ${title}\nTags: ${tags}\n\n${content}`;
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${title}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    </script>
</body>
</html>
